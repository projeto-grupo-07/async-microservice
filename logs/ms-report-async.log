2026-02-26 23:23:44.511 [background-preinit] INFO  o.h.validator.internal.util.Version [] - HV000001: Hibernate Validator 9.0.1.Final
2026-02-26 23:23:44.660 [restartedMain] INFO  c.e.m.MsReportAsyncApplication [] - Starting MsReportAsyncApplication using Java 21.0.8 with PID 3116 (C:\Users\guilh\OneDrive\Desktop\sptech\PI\ms async\ms-report-async\target\classes started by guilh in C:\Users\guilh\OneDrive\Desktop\sptech\PI\ms async\ms-report-async)
2026-02-26 23:23:44.660 [restartedMain] DEBUG c.e.m.MsReportAsyncApplication [] - Running with Spring Boot v4.0.3, Spring v7.0.5
2026-02-26 23:23:44.662 [restartedMain] INFO  c.e.m.MsReportAsyncApplication [] - No active profile set, falling back to 1 default profile: "default"
2026-02-26 23:23:44.759 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor [] - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2026-02-26 23:23:44.759 [restartedMain] INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor [] - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2026-02-26 23:23:48.749 [restartedMain] INFO  o.s.boot.tomcat.TomcatWebServer [] - Tomcat initialized with port 8080 (http)
2026-02-26 23:23:48.773 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol [] - Initializing ProtocolHandler ["http-nio-8080"]
2026-02-26 23:23:48.777 [restartedMain] INFO  o.a.catalina.core.StandardService [] - Starting service [Tomcat]
2026-02-26 23:23:48.777 [restartedMain] INFO  o.a.catalina.core.StandardEngine [] - Starting Servlet engine: [Apache Tomcat/11.0.18]
2026-02-26 23:23:48.881 [restartedMain] INFO  o.s.b.w.c.s.WebApplicationContextInitializer [] - Root WebApplicationContext: initialization completed in 4121 ms
2026-02-26 23:23:49.353 [restartedMain] WARN  s.a.a.p.internal.ProfileFileReader [] - Ignoring profile '[default]' on line 3, because '[profile default]' was already seen in the same file.
2026-02-26 23:23:51.948 [restartedMain] INFO  o.s.b.a.e.web.EndpointLinksResolver [] - Exposing 1 endpoint beneath base path '/actuator'
2026-02-26 23:23:52.007 [restartedMain] DEBUG o.s.a.r.l.a.MessagingMessageListenerAdapter [] - Inferred argument type for public void com.example.ms_report_async.infraestructure.async.RabbitImportListener.receive(java.lang.String) is class java.lang.String
2026-02-26 23:23:52.043 [restartedMain] DEBUG o.s.a.r.l.SimpleMessageListenerContainer [] - No global properties bean
2026-02-26 23:23:52.091 [restartedMain] INFO  o.a.coyote.http11.Http11NioProtocol [] - Starting ProtocolHandler ["http-nio-8080"]
2026-02-26 23:23:52.125 [restartedMain] INFO  o.s.boot.tomcat.TomcatWebServer [] - Tomcat started on port 8080 (http) with context path '/'
2026-02-26 23:23:52.127 [restartedMain] DEBUG o.s.a.r.l.SimpleMessageListenerContainer [] - Starting Rabbit listener container.
2026-02-26 23:23:52.137 [restartedMain] INFO  o.s.a.r.c.CachingConnectionFactory [] - Attempting to connect to: [localhost:5672]
2026-02-26 23:23:52.349 [restartedMain] INFO  o.s.a.r.c.CachingConnectionFactory [] - Created new connection: rabbitConnectionFactory#5113ecf3:0/SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681]
2026-02-26 23:23:52.352 [restartedMain] DEBUG o.s.amqp.rabbit.core.RabbitAdmin [] - Initializing declarations
2026-02-26 23:23:52.376 [restartedMain] DEBUG o.s.a.r.c.CachingConnectionFactory [] - Creating cached Rabbit Channel from AMQChannel(amqp://guest@127.0.0.1:5672/,1)
2026-02-26 23:23:52.390 [restartedMain] DEBUG o.s.amqp.rabbit.core.RabbitTemplate [] - Executing callback  on RabbitMQ Channel: Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681]
2026-02-26 23:23:52.390 [restartedMain] DEBUG o.s.amqp.rabbit.core.RabbitAdmin [] - declaring Exchange 'import_exchange3'
2026-02-26 23:23:52.397 [restartedMain] DEBUG o.s.amqp.rabbit.core.RabbitAdmin [] - declaring Queue 'import_csv_queue3'
2026-02-26 23:23:52.404 [restartedMain] DEBUG o.s.amqp.rabbit.core.RabbitAdmin [] - Binding destination [import_csv_queue3 (QUEUE)] to exchange [import_exchange3] with routing key [import.csv3]
2026-02-26 23:23:52.437 [restartedMain] DEBUG o.s.amqp.rabbit.core.RabbitAdmin [] - Declarations finished
2026-02-26 23:23:52.449 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.amqp.rabbit.core.RabbitTemplate [] - Executing callback  on RabbitMQ Channel: Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681]
2026-02-26 23:23:52.454 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - Starting consumer Consumer@15a83a2f: tags=[[]], channel=null, acknowledgeMode=AUTO local queue size=0
2026-02-26 23:23:52.477 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - Started on queue 'import_csv_queue3' with tag amq.ctag-ljLUKMpjDGRNjMFcVQblEg: Consumer@15a83a2f: tags=[[]], channel=Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681], acknowledgeMode=AUTO local queue size=0
2026-02-26 23:23:52.477 [pool-3-thread-3] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - ConsumeOK: Consumer@15a83a2f: tags=[[amq.ctag-ljLUKMpjDGRNjMFcVQblEg]], channel=Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681], acknowledgeMode=AUTO local queue size=0
2026-02-26 23:23:52.491 [restartedMain] INFO  c.e.m.MsReportAsyncApplication [] - Started MsReportAsyncApplication in 9.143 seconds (process running for 10.51)
2026-02-26 23:24:05.305 [http-nio-8080-exec-7] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] [] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2026-02-26 23:24:05.305 [http-nio-8080-exec-7] INFO  o.s.web.servlet.DispatcherServlet [] - Initializing Servlet 'dispatcherServlet'
2026-02-26 23:24:05.307 [http-nio-8080-exec-7] INFO  o.s.web.servlet.DispatcherServlet [] - Completed initialization in 1 ms
2026-02-26 23:24:05.372 [http-nio-8080-exec-7] INFO  c.e.m.i.r.impl.ImportControllerImpl [] - Recebendo requisição de importação. FileKey: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:05.373 [http-nio-8080-exec-7] DEBUG c.e.m.i.async.RabbitImportProducer [] - Gerando novo JobId: 1dbd489e-de3a-4a81-96ca-719e4674d581 para FileKey: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:05.377 [http-nio-8080-exec-7] DEBUG o.s.a.r.c.CachingConnectionFactory [] - Creating cached Rabbit Channel from AMQChannel(amqp://guest@127.0.0.1:5672/,2)
2026-02-26 23:24:05.378 [http-nio-8080-exec-7] DEBUG o.s.amqp.rabbit.core.RabbitTemplate [] - Executing callback  on RabbitMQ Channel: Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,2), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681]
2026-02-26 23:24:05.401 [http-nio-8080-exec-7] DEBUG o.s.amqp.rabbit.core.RabbitTemplate [] - Publishing message [(Body:'[B@47c6533a(byte[100])' MessageProperties [headers={}, contentType=text/plain, contentEncoding=UTF-8, contentLength=100, deliveryMode=PERSISTENT, priority=0, deliveryTag=0])] on exchange [import_exchange3], routingKey = [import.csv3]
2026-02-26 23:24:05.409 [http-nio-8080-exec-7] INFO  c.e.m.i.async.RabbitImportProducer [] - Mensagem publicada no RabbitMQ com sucesso. Exchange: import_exchange3, RoutingKey: import.csv3, JobId: 1dbd489e-de3a-4a81-96ca-719e4674d581
2026-02-26 23:24:05.410 [http-nio-8080-exec-7] INFO  c.e.m.i.r.impl.ImportControllerImpl [] - Importação enfileirada com sucesso. JobId: 1dbd489e-de3a-4a81-96ca-719e4674d581, FileKey: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:05.427 [pool-3-thread-4] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - Storing delivery for consumerTag: 'amq.ctag-ljLUKMpjDGRNjMFcVQblEg' with deliveryTag: '1' in Consumer@15a83a2f: tags=[[amq.ctag-ljLUKMpjDGRNjMFcVQblEg]], channel=Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681], acknowledgeMode=AUTO local queue size=0
2026-02-26 23:24:05.428 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - Received message: (Body:'[B@7655aaeb(byte[100])' MessageProperties [headers={}, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=import_exchange3, receivedRoutingKey=import.csv3, deliveryTag=1, consumerTag=amq.ctag-ljLUKMpjDGRNjMFcVQblEg, consumerQueue=import_csv_queue3])
2026-02-26 23:24:05.448 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.l.a.MessagingMessageListenerAdapter [] - Processing [GenericMessage [payload={"jobId":"1dbd489e-de3a-4a81-96ca-719e4674d581", "fileKey":"estatisticas_di_2025_10-12_trusted.csv"}, headers={amqp_receivedDeliveryMode=PERSISTENT, amqp_receivedExchange=import_exchange3, amqp_deliveryTag=1, amqp_consumerQueue=import_csv_queue3, amqp_redelivered=false, amqp_receivedRoutingKey=import.csv3, amqp_contentEncoding=UTF-8, amqp_retryCount=0, id=0fb19ccd-7f12-723e-9239-a385faed37da, amqp_consumerTag=amq.ctag-ljLUKMpjDGRNjMFcVQblEg, amqp_lastInBatch=false, contentType=text/plain, timestamp=1772159045447}]]
2026-02-26 23:24:05.450 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.i.async.RabbitImportListener [] - Mensagem recebida do RabbitMQ: {"jobId":"1dbd489e-de3a-4a81-96ca-719e4674d581", "fileKey":"estatisticas_di_2025_10-12_trusted.csv"}
2026-02-26 23:24:05.504 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.i.async.RabbitImportListener [] - Iniciando processamento. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", FileKey: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:05.504 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.a.u.ProcessImportFileUseCaseImpl [] - Iniciando processamento do arquivo. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", FileKey: estatisticas_di_2025_10-12_trusted.csv, Bucket: brinks-bucket-1
2026-02-26 23:24:05.504 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.infraestructure.s3.S3Adapter [] - Iniciando download do S3. Bucket: brinks-bucket-1, Key: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:07.036 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.infraestructure.s3.S3Adapter [] - Download do S3 iniciado com sucesso. Bucket: brinks-bucket-1, Key: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:07.037 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.a.u.ProcessImportFileUseCaseImpl [] - Arquivo baixado com sucesso do S3. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", FileKey: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:24:07.037 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.i.csv.CsvParserAdapter [] - Iniciando parsing do arquivo CSV
2026-02-26 23:24:07.053 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.i.csv.CsvParserAdapter [] - Validando headers do CSV. Headers encontrados: [, ncm, pais_origem, volume_total, valor_total, preco_medio, frete_medio, seguro_medio]
2026-02-26 23:24:07.055 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.i.csv.CsvParserAdapter [] - Headers validados com sucesso
2026-02-26 23:24:07.063 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.i.csv.CsvParserAdapter [] - CSV parsing concluído com sucesso. TotalLinhas: 70, DuracaoMs: 25
2026-02-26 23:24:07.063 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.a.u.ProcessImportFileUseCaseImpl [] - CSV parseado com sucesso. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", TotalLinhas: 70
2026-02-26 23:24:07.063 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.a.u.ProcessImportFileUseCaseImpl [] - Consolidando relatório de importação. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", TotalLinhas: 70
2026-02-26 23:24:07.064 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.a.u.ProcessImportFileUseCaseImpl [] - Relatório consolidado. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", Linhas: 70
2026-02-26 23:24:07.065 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.i.pdf.PdfGeneratorAdapter [] - Iniciando geração do PDF. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", TotalLinhas: 70
2026-02-26 23:24:07.775 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.i.pdf.PdfGeneratorAdapter [] - Documento PDF construído em memória. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", TamanhoBytes: 6895
2026-02-26 23:24:07.775 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG c.e.m.i.pdf.PdfGeneratorAdapter [] - PDF gerado com sucesso. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", TamanhoBytes: 6895
2026-02-26 23:24:07.776 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.infraestructure.s3.S3Adapter [] - Iniciando upload para S3. Bucket: brinks-bucket-2, Key: reports/import-report-"1dbd489e-de3a-4a81-96ca-719e4674d581".pdf, ContentType: application/pdf, TamanhoBytes: 6895
2026-02-26 23:24:08.573 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.infraestructure.s3.S3Adapter [] - Upload para S3 concluído com sucesso. Bucket: brinks-bucket-2, Key: reports/import-report-"1dbd489e-de3a-4a81-96ca-719e4674d581".pdf
2026-02-26 23:24:08.573 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.i.pdf.PdfGeneratorAdapter [] - PDF salvo no S3 com sucesso. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", PdfKey: reports/import-report-"1dbd489e-de3a-4a81-96ca-719e4674d581".pdf, DuracaoMs: 1508
2026-02-26 23:24:08.573 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.a.u.ProcessImportFileUseCaseImpl [] - Processamento concluído com sucesso. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", PdfKey: reports/import-report-"1dbd489e-de3a-4a81-96ca-719e4674d581".pdf, DuracaoMs: 3069
2026-02-26 23:24:08.573 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] INFO  c.e.m.i.async.RabbitImportListener [] - Processamento concluído com sucesso. JobId: "1dbd489e-de3a-4a81-96ca-719e4674d581", FileKey: estatisticas_di_2025_10-12_trusted.csv
2026-02-26 23:26:23.646 [SpringApplicationShutdownHook] DEBUG o.s.a.r.l.SimpleMessageListenerContainer [] - Shutting down Rabbit listener container
2026-02-26 23:26:23.672 [pool-3-thread-5] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - Received cancelOk for tag amq.ctag-ljLUKMpjDGRNjMFcVQblEg (import_csv_queue3); Consumer@15a83a2f: tags=[[amq.ctag-ljLUKMpjDGRNjMFcVQblEg]], channel=Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681], acknowledgeMode=AUTO local queue size=0
2026-02-26 23:26:23.672 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  o.s.a.r.l.SimpleMessageListenerContainer [] - Waiting for workers to finish.
2026-02-26 23:26:23.767 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  o.s.a.r.l.SimpleMessageListenerContainer [] - Successfully waited for workers to finish.
2026-02-26 23:26:23.768 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.l.SimpleMessageListenerContainer [] - Cancelling Consumer@15a83a2f: tags=[[amq.ctag-ljLUKMpjDGRNjMFcVQblEg]], channel=Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681], acknowledgeMode=AUTO local queue size=0
2026-02-26 23:26:23.768 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.l.BlockingQueueConsumer [] - Closing Rabbit Channel: Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@76c718cc Shared Rabbit Connection: SimpleConnection@1414589c [delegate=amqp://guest@127.0.0.1:5672/, localPort=61681]
2026-02-26 23:26:23.769 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] DEBUG o.s.a.r.c.CachingConnectionFactory [] - Closing cached Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1)
2026-02-26 23:26:23.771 [SpringApplicationShutdownHook] INFO  o.s.boot.tomcat.GracefulShutdown [] - Commencing graceful shutdown. Waiting for active requests to complete
2026-02-26 23:26:23.783 [tomcat-shutdown] INFO  o.s.boot.tomcat.GracefulShutdown [] - Graceful shutdown complete
2026-02-26 23:26:23.790 [SpringApplicationShutdownHook] DEBUG o.s.a.r.c.CachingConnectionFactory [] - Closing cached Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,2)
2026-02-26 23:26:23.803 [SpringApplicationShutdownHook] DEBUG o.s.a.r.l.SimpleMessageListenerContainer [] - Shutdown ignored - container is not active already
